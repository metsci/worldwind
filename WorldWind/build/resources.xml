<?xml version="1.0" encoding="ISO-8859-1"?>
<!--
  ~ Copyright (C) 2012 United States Government as represented by the Administrator of the
  ~ National Aeronautics and Space Administration.
  ~ All Rights Reserved.
  -->

<!--$Id$-->
<project name="resources">

    <!-- Rasterization height for the Forward Edge of Battle (FEBA, 2.X.2.4.2.1) image. -->
    <property name="resources.rasterize.height.feba" value="16"/>

    <!-- Creates the World Wind Symbol Icons package in the folder 'milstd2525-symbols'. -->
    <target name="resources.milstd2525.symbols"
            description="Creates the World Wind Symbol Icons package in the folder 'milstd2525-symbols'.">
        <!-- Create a directory to store the rasterized output from the MIL-STD-2525 SVG sources. -->
        <mkdir dir="${resources.milstd2525.symbols.dir}"/>
        <!-- Rasterize all MIL-STD-2525 SVG source directories. Special cases are handled below. -->
        <rasterize-svgdirs maxwidth="${resources.rasterize.width}" height="${resources.rasterize.height}"
                           destdir="${resources.milstd2525.symbols.dir}">
            <svgdirs>
                <dirset dir="${resources.milstd2525.dir}"/>
            </svgdirs>
        </rasterize-svgdirs>
        <!-- Rasterize the Forward Edge of Battle (FEBA, 2.X.2.4.2.1) image. This image is not used in the same way as
             other MIL-STD-2525 tactical point graphics, and therefore must be rasterized with a different height. -->
        <rasterize-svgfiles maxwidth="${resources.rasterize.width}" height="${resources.rasterize.height.feba}"
                            destdir="${resources.milstd2525.symbols.dir}" force="true">
            <svgfiles>
                <fileset dir="${resources.milstd2525.dir}">
                    <include name="**/g-g?dlf-------x.svg"/>
                    <type type="file"/>
                </fileset>
            </svgfiles>
        </rasterize-svgfiles>
    </target>

    <!-- Packages the World Wind MIL-STD-2525 Symbol Icons ZIP archive into the file 'milstd2525-symbols.zip'. -->
    <target name="resources.milstd2525.symbols.zipfile" depends="resources.milstd2525.symbols"
            description="Packages the World Wind MIL-STD-2525 Symbol Icons ZIP archive into the file 'milstd2525-symbols.zip'.">
        <zip destfile="${resources.milstd2525.symbols.zipfile}">
            <fileset dir="${resources.milstd2525.symbols.dir}"/>
        </zip>
    </target>

    <!-- Individual clean targets corresponding to each build target above. -->
    <target name="clean.resources.milstd2525.symbols">
        <delete dir="${resources.milstd2525.symbols.dir}"/>
        <delete file="${resources.milstd2525.symbols.zipfile}"/>
    </target>
    <!-- Main clean target for resource build targets. Removes all files and directories created by all resource build
         targets. -->
    <target name="clean.resources.all" depends="clean.resources.milstd2525.symbols"/>

    <macrodef name="rasterize-svgdirs">
        <attribute name="maxwidth"/>
        <attribute name="height"/>
        <attribute name="destdir"/>
        <attribute name="force" default="false"/>
        <element name="svgdirs"/>
        <sequential>
            <apply executable="java" dest="@{destdir}" force="@{force}" failonerror="true">
                <arg value="-jar"/>
                <arg value="${basedir}/build/lib/batik/batik-rasterizer.jar"/>
                <arg value="-m"/>
                <arg value="image/png"/>
                <arg value="-maxw"/>
                <arg value="@{maxwidth}"/>
                <arg value="-h"/>
                <arg value="@{height}"/>
                <arg value="-d"/>
                <targetfile/>
                <svgdirs/>
                <mapper type="identity"/>
            </apply>
        </sequential>
    </macrodef>

    <macrodef name="rasterize-svgfiles">
        <attribute name="maxwidth"/>
        <attribute name="height"/>
        <attribute name="destdir"/>
        <attribute name="force" default="false"/>
        <element name="svgfiles"/>
        <sequential>
            <apply executable="java" dest="@{destdir}" force="@{force}" failonerror="true">
                <arg value="-jar"/>
                <arg value="${basedir}/build/lib/batik/batik-rasterizer.jar"/>
                <arg value="-m"/>
                <arg value="image/png"/>
                <arg value="-maxw"/>
                <arg value="@{maxwidth}"/>
                <arg value="-h"/>
                <arg value="@{height}"/>
                <arg value="-d"/>
                <targetfile/>
                <svgfiles/>
                <mapper type="glob" from="*.svg" to="*.png"/>
            </apply>
        </sequential>
    </macrodef>

</project>
